<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>All LLM Paper Explainers</title>
  <meta name="description" content="Browse every interactive research explainer with quick search, tag filtering, and share links." />
  <link rel="icon" href="favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    ::selection { background:#4338ca; color:#fff; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-5xl mx-auto px-4 py-5 flex flex-col md:flex-row md:items-center gap-4">
      <div class="flex-1 min-w-0">
        <h1 class="text-2xl font-bold text-gray-900">All Papers</h1>
        <p class="text-sm text-gray-600">Deep dives on influential LLM research with interactive explainers.</p>
      </div>
      <div class="flex items-center gap-3 w-full md:w-auto">
        <input id="search" type="text" placeholder="Search titles, authors, tags" class="flex-1 md:w-80 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <a href="index.html#papers" class="px-4 py-2 text-sm bg-indigo-600 text-white rounded-md shadow hover:bg-indigo-700">Back</a>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex flex-wrap items-center gap-2 mb-6 text-xs" id="tag-filters" aria-label="Tag filters">
      <!-- Tag filters populated via script -->
    </div>
    <div id="count" class="text-sm text-gray-600 mb-4">Loading papers…</div>
    <ul id="paper-list" class="grid sm:grid-cols-2 gap-4"></ul>
    <div id="error" class="hidden mt-6 p-4 border border-red-200 bg-red-50 text-sm text-red-700 rounded-md"></div>
  </main>

  <footer class="mt-16 border-t bg-white border-gray-200">
    <div class="max-w-5xl mx-auto px-4 py-8 text-center text-xs text-gray-500">
      <p>Interactive LLM Learning Experience • <a class="text-indigo-600 hover:underline" href="index.html#">Return to landing</a></p>
      <p class="mt-2">Static share links live under <code class="px-1 py-0.5 bg-gray-100 rounded">/p/N.html</code></p>
    </div>
  </footer>

  <script>
    const listEl = document.getElementById('paper-list');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');
    const tagFiltersEl = document.getElementById('tag-filters');
    const errorEl = document.getElementById('error');

    const state = { text: '', tag: 'all', papers: [] };

    function sanitizeJSON(raw){
      if(raw.charCodeAt(0) === 0xFEFF){
        raw = raw.slice(1);
      }
      return raw.trim() || '{}';
    }

    function formatAuthors(authors){
      if(!Array.isArray(authors) || !authors.length) return 'Unknown authors';
      if(authors.length === 1) return authors[0];
      if(authors.length === 2) return `${authors[0]} & ${authors[1]}`;
      return `${authors.slice(0, -1).join(', ')}, & ${authors[authors.length - 1]}`;
    }

    function tagPill(tag){
      return `<span class="inline-flex items-center gap-1 px-2 py-0.5 border border-indigo-200 bg-indigo-50 text-indigo-700 rounded-full text-[11px] font-medium uppercase tracking-wide">${tag}</span>`;
    }

    function buildTagFilters(tags){
      const entries = ['all', ...tags];
      tagFiltersEl.innerHTML = entries.map(tag => {
        const isActive = state.tag === tag;
        const label = tag === 'all' ? 'All' : tag;
        const base = 'px-3 py-1.5 rounded-full border text-xs font-medium tracking-wide transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 capitalize';
        const stateClass = isActive
          ? 'bg-indigo-600 border-indigo-600 text-white shadow-sm'
          : 'bg-white border-gray-300 text-gray-700 hover:border-indigo-400 hover:text-indigo-600';
        return `<button type="button" data-tag="${tag}" class="${base} ${stateClass}">${label}</button>`;
      }).join('');
      tagFiltersEl.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          state.tag = btn.dataset.tag;
          buildTagFilters(tags);
          render();
        });
      });
    }

    function render(){
      const term = state.text.trim().toLowerCase();
      const filtered = state.papers.filter(paper => {
        const matchesTag = state.tag === 'all' || paper.tags.includes(state.tag);
        if(!matchesTag) return false;
        if(!term) return true;
        const haystack = [paper.title, paper.summary, paper.venue, paper.authors.join(' '), paper.tags.join(' ')].join(' ').toLowerCase();
        return haystack.includes(term);
      });

      if(!filtered.length){
        countEl.textContent = 'No papers match your filters yet.';
      } else if(filtered.length === state.papers.length){
        countEl.textContent = `Showing all ${state.papers.length} papers`;
      } else {
        countEl.textContent = `Showing ${filtered.length} of ${state.papers.length} papers`;
      }

      listEl.innerHTML = filtered.map(paper => {
        const num = paper.index.toString().padStart(2,'0');
        const tags = paper.tags.map(tagPill).join(' ');
        return `
          <li>
            <article class="h-full flex flex-col bg-white border border-gray-200 rounded-lg shadow-sm hover:border-indigo-400 transition-colors">
              <a href="index.html#paper-${paper.index}" class="flex-1 px-4 py-5 space-y-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-t-lg">
                <div class="flex items-start justify-between gap-3">
                  <div class="text-xs font-semibold uppercase tracking-wide text-gray-500">Paper ${num}</div>
                  <span class="inline-flex items-center px-2 py-0.5 text-[11px] font-medium rounded bg-gray-100 text-gray-700 border border-gray-200">Interactive</span>
                </div>
                <h2 class="text-base font-semibold text-gray-900 leading-snug">${paper.title}</h2>
                <p class="text-xs text-gray-500">${formatAuthors(paper.authors)} • ${paper.venue || 'Unknown venue'}</p>
                <p class="text-sm text-gray-700 leading-relaxed">${paper.summary || 'Overview forthcoming.'}</p>
                ${tags ? `<div class="flex flex-wrap gap-1.5">${tags}</div>` : ''}
              </a>
              <div class="px-4 py-3 border-t border-gray-200 bg-gray-50 text-xs flex items-center justify-between rounded-b-lg">
                <a class="text-indigo-600 hover:text-indigo-700 font-medium" href="p/${paper.index}.html" aria-label="Open static share page for paper ${paper.index}">Static share</a>
                <span class="text-gray-500">Updated ${paper.year || '—'}</span>
              </div>
            </article>
          </li>
        `;
      }).join('');
    }

    async function init(){
      try {
        const res = await fetch('./papers/manifest.json', { cache: 'no-store' });
        if(!res.ok){
          throw new Error(`Manifest fetch failed (${res.status})`);
        }
        const text = await res.text();
        const data = JSON.parse(sanitizeJSON(text));
        const papers = Object.keys(data)
          .map(key => ({ key, index: Number(key), ...data[key] }))
          .filter(entry => Number.isFinite(entry.index) && entry.index > 0)
          .sort((a,b) => a.index - b.index)
          .map(entry => ({
            index: entry.index,
            title: entry.title || `Paper ${entry.index}`,
            authors: Array.isArray(entry.authors) ? entry.authors : [],
            year: entry.year || '',
            venue: entry.venue || '',
            tags: Array.isArray(entry.tags) ? entry.tags : [],
            summary: entry.summary || '',
            dir: entry.dir || ''
          }));

        state.papers = papers;

        const uniqueTags = Array.from(new Set(papers.flatMap(p => p.tags))).sort((a,b) => a.localeCompare(b));
        buildTagFilters(uniqueTags);
        render();
      } catch (error) {
        console.error('Failed to initialise papers page:', error);
        errorEl.textContent = 'Could not load the paper manifest. Please refresh or try again later.';
        errorEl.classList.remove('hidden');
        countEl.textContent = 'Unable to load papers.';
      }
    }

    searchEl.addEventListener('input', () => {
      state.text = searchEl.value;
      render();
    });

    init();
  </script>
</body>
</html>
