<section class="space-y-6" id="p43-explorer">
  <!-- Intro panel with analogy -->
  <div class="panel panel-neutral-soft p-4 space-y-2">
    <p class="text-sm text-body">
      <strong>Think of it like this:</strong> A doctor diagnosing illness works both ways: symptoms → disease (diagnosis) and disease → symptoms (prediction). If you can't reverse the process accurately, your understanding is incomplete. MISTAKE uses the same principle for student errors: misconception → wrong answer → inferred misconception. High "round-trip" accuracy means your synthetic training data is realistic.
    </p>
  </div>

  <!-- Controls -->
  <div class="panel panel-info p-4 space-y-4">
    <h3 class="text-sm font-semibold text-heading">MISTAKE cycle consistency simulator</h3>
    
    <!-- Task selector -->
    <div class="space-y-2">
      <label for="p43-task" class="block text-sm font-medium text-heading">
        Educational task
      </label>
      <select id="p43-task" 
              class="w-full px-3 py-2 rounded border border-divider bg-card text-body focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-[color:var(--accent-strong)]">
        <option value="algebra">Algebra (equation solving)</option>
        <option value="fractions">Fractions (operations & simplification)</option>
        <option value="geometry">Geometry (area & perimeter)</option>
      </select>
      <p class="text-xs text-muted italic">
        Domain where student errors and misconceptions are modeled
      </p>
    </div>

    <!-- Training data size -->
    <div class="space-y-2">
      <label for="p43-training-size" class="block text-sm font-medium text-heading">
        Expert seed examples: <span id="p43-training-label" class="font-mono">50</span>
      </label>
      <input type="range" id="p43-training-size" 
             min="20" max="200" step="10" value="50"
             class="w-full accent-[color:var(--accent-strong)]">
      <p class="text-xs text-muted italic">
        Hand-labeled examples from domain experts showing correct misconception-answer pairs (e.g., "distribution error" → "3x + 2" for "3(x + 2)"). MISTAKE multiplies these into thousands of synthetic pairs.
      </p>
    </div>

    <!-- Cycle consistency threshold -->
    <div class="space-y-2">
      <label for="p43-consistency" class="block text-sm font-medium text-heading">
        Cycle consistency threshold: <span id="p43-consistency-label" class="font-mono">0.70</span>
      </label>
      <input type="range" id="p43-consistency" 
             min="0.5" max="0.95" step="0.05" value="0.70"
             class="w-full accent-[color:var(--accent-strong)]">
      <p class="text-xs text-muted italic">
        Quality filter: if model generates "3x + 2" from "distribution error" and correctly infers "distribution error" back from the answer, that's 100% round-trip accuracy—example passes. Lower thresholds accept more examples but risk lower quality.
      </p>
    </div>
  </div>

  <!-- Training data generation results -->
  <div class="panel panel-neutral p-4 space-y-4">
    <h3 class="text-sm font-semibold text-heading">Synthetic data generation</h3>
    
    <div class="space-y-3">
      <!-- Synthetic examples generated -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">Candidate examples generated</span>
          <span id="p43-generated-count" class="text-xs font-semibold text-body">5,000</span>
        </div>
        <div class="w-full bg-surface rounded-full h-2 overflow-hidden">
          <div id="p43-generated-bar" class="h-2 rounded-full transition-all duration-300" style="width: 100%; background-color: #6366f1;"></div>
        </div>
      </div>

      <!-- Examples passing cycle consistency -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">Examples passing consistency filter</span>
          <span id="p43-filtered-count" class="text-xs font-semibold text-body">3,500 (70%)</span>
        </div>
        <div class="w-full bg-surface rounded-full h-2 overflow-hidden">
          <div id="p43-filtered-bar" class="h-2 rounded-full transition-all duration-300" style="width: 70%; background-color: #10b981;"></div>
        </div>
      </div>

      <!-- Final training dataset -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">Total training examples (seed + synthetic)</span>
          <span id="p43-total-count" class="text-xs font-semibold text-body">3,550</span>
        </div>
        <p class="text-xs text-muted italic">
          Combined dataset for fine-tuning student simulation, misconception inference, and distractor generation models
        </p>
      </div>
    </div>
  </div>

  <!-- Example cycle consistency demonstration -->
  <div class="panel panel-neutral p-4 space-y-4">
    <h3 class="text-sm font-semibold text-heading">Cycle consistency example</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <!-- Step 1: Misconception -->
      <div class="space-y-2">
        <h4 class="text-xs font-semibold text-heading uppercase tracking-wide">1. Misconception</h4>
        <div class="panel panel-neutral-soft p-3 min-h-[6rem]">
          <p id="p43-misconception" class="text-xs text-body font-mono">
            "When distributing, only multiply the first term inside the parenthesis"
          </p>
        </div>
      </div>
      
      <!-- Step 2: Generated incorrect answer -->
      <div class="space-y-2">
        <h4 class="text-xs font-semibold text-heading uppercase tracking-wide">2. Generated answer</h4>
        <div class="panel panel-neutral-soft p-3 min-h-[6rem]">
          <p class="text-xs text-body">
            <strong>Problem:</strong> <span id="p43-problem">Expand 3(x + 2)</span>
          </p>
          <p class="text-xs text-body mt-2">
            <strong>Generated:</strong> <span id="p43-answer" class="font-mono">3x + 2</span>
          </p>
        </div>
      </div>

      <!-- Step 3: Inferred misconception -->
      <div class="space-y-2">
        <h4 class="text-xs font-semibold text-heading uppercase tracking-wide">3. Inferred misconception</h4>
        <div class="panel panel-neutral-soft p-3 min-h-[6rem]">
          <p id="p43-inferred" class="text-xs text-body font-mono">
            "When distributing, only multiply the first term inside the parenthesis"
          </p>
          <div class="mt-2 flex items-center gap-1">
            <span id="p43-match-icon" class="text-lg">✓</span>
            <span id="p43-match-text" class="text-xs font-semibold" style="color: #10b981;">Match! Keep example</span>
          </div>
        </div>
      </div>
    </div>

    <div class="panel panel-neutral-soft p-3 mt-3">
      <p class="text-xs text-body">
        <strong>Round-trip accuracy:</strong> <span id="p43-roundtrip" class="font-semibold">100%</span> — Original misconception matches inferred misconception, so this synthetic example is pedagogically coherent and added to training data.
      </p>
    </div>
  </div>

  <!-- Task performance metrics -->
  <div class="panel panel-success p-4 space-y-3">
    <h3 class="text-sm font-semibold text-heading">Performance improvements over baseline</h3>
    <p class="text-xs text-body">
      MISTAKE training shows measurable gains across all three educational tasks (tested on EEDI dataset with 1,857 K-12 math questions):
    </p>
    
    <div class="space-y-3">
      <!-- Student simulation -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">1. Student simulation (misconception → answer)</span>
          <span id="p43-simulation-acc" class="text-xs font-semibold text-body">+9%</span>
        </div>
        <div class="w-full bg-surface rounded-full h-2 overflow-hidden">
          <div id="p43-simulation-bar" class="h-2 rounded-full transition-all duration-300" style="width: 45%; background-color: #10b981;"></div>
        </div>
        <p class="text-xs text-muted italic">
          Improvement in accuracy at generating realistic incorrect answers given specific misconceptions
        </p>
      </div>

      <!-- Misconception inference -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">2. Misconception inference (answer → misconception)</span>
          <span id="p43-inference-acc" class="text-xs font-semibold text-body">+15%</span>
        </div>
        <div class="w-full bg-surface rounded-full h-2 overflow-hidden">
          <div id="p43-inference-bar" class="h-2 rounded-full transition-all duration-300" style="width: 75%; background-color: #10b981;"></div>
        </div>
        <p class="text-xs text-muted italic">
          Improvement in diagnosing underlying misconception from observed incorrect answer
        </p>
      </div>

      <!-- Distractor generation -->
      <div class="space-y-1">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-body">3. Distractor generation (problem → wrong answers)</span>
          <span id="p43-distractor-acc" class="text-xs font-semibold text-body">+64.6%</span>
        </div>
        <div class="w-full bg-surface rounded-full h-2 overflow-hidden">
          <div id="p43-distractor-bar" class="h-2 rounded-full transition-all duration-300" style="width: 100%; background-color: #10b981;"></div>
        </div>
        <p class="text-xs text-muted italic">
          Increase in precision when matching expert-written distractors for multiple-choice assessments
        </p>
      </div>
    </div>
  </div>

  <!-- Key insights -->
  <div class="panel panel-warning p-4 space-y-3">
    <h3 class="text-sm font-semibold text-heading">Key insights from configuration</h3>
    <div id="p43-insights" class="space-y-2 text-xs text-body">
      <p>
        <strong>Current setup:</strong> With 50 expert seed examples and 0.70 cycle consistency threshold, you generate 3,500 high-quality synthetic examples for a total training set of 3,550 misconception-answer pairs.
      </p>
      <p>
        <strong>Why this matters:</strong> Cycle consistency acts as an automated quality filter. Higher thresholds (0.85+) keep only the most pedagogically coherent examples but reduce training data size. Lower thresholds (0.60-) accept more examples but risk including unrealistic error patterns. The sweet spot (0.70-0.80) balances data quantity with quality.
      </p>
    </div>
  </div>
</section>
