<div class="space-y-6" id="q27-interactive-root">
  <div class="panel panel-info p-4 space-y-3">
    <label for="q27-function-type" class="block text-sm font-medium text-heading">📝 Choose function type</label>
    <select id="q27-function-type" aria-describedby="q27-function-type-help" class="field-select w-full">
      <option value="linear" selected>Linear Transformation (W·x + b)</option>
      <option value="softmax">Softmax Function</option>
      <option value="attention">Attention Mechanism</option>
      <option value="layer-norm">Layer Normalization</option>
      <option value="feed-forward">Feed-Forward Network</option>
    </select>
    <p id="q27-function-type-help" class="small-caption panel-muted">Different function types have different Jacobian structures and computational properties.</p>
  </div>

  <div class="panel panel-neutral p-4 space-y-4">
    <span class="text-sm font-medium text-heading">🎯 Choose analysis mode</span>
    <p class="small-caption panel-muted">Tap a card to switch the Jacobian view; the filled circle marks the active option.</p>
    <div class="grid grid-cols-1 gap-3 md:grid-cols-3">
      <label class="q27-mode-option q26-mode-card panel panel-neutral-soft" data-mode="structure">
        <input type="radio" name="q27-mode" value="structure" class="sr-only" checked>
        <div class="q26-mode-card-body">
          <div class="q26-mode-header">
            <span class="q26-mode-title">Matrix structure</span>
            <span class="chip chip-success text-xs">Visual</span>
          </div>
          <p class="small-caption panel-muted">Show Jacobian matrix structure and sparsity.</p>
        </div>
      </label>

      <label class="q27-mode-option q26-mode-card panel panel-neutral-soft" data-mode="computation">
        <input type="radio" name="q27-mode" value="computation" class="sr-only">
        <div class="q26-mode-card-body">
          <div class="q26-mode-header">
            <span class="q26-mode-title">Computation</span>
            <span class="chip chip-info text-xs">Math</span>
          </div>
          <p class="small-caption panel-muted">Show step-by-step Jacobian computation.</p>
        </div>
      </label>

      <label class="q27-mode-option q26-mode-card panel panel-neutral-soft" data-mode="backprop">
        <input type="radio" name="q27-mode" value="backprop" class="sr-only">
        <div class="q26-mode-card-body">
          <div class="q26-mode-header">
            <span class="q26-mode-title">Backprop flow</span>
            <span class="chip chip-accent text-xs">Flow</span>
          </div>
          <p class="small-caption panel-muted">Show how gradients flow through the Jacobian.</p>
        </div>
      </label>
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div class="panel panel-neutral p-4 space-y-2">
      <label for="q27-input-dim" class="block text-sm font-medium text-heading">📊 Input dimension</label>
      <select id="q27-input-dim" aria-describedby="q27-input-dim-help" class="field-select w-full">
        <option value="2">2D (for visualization)</option>
        <option value="3" selected>3D (small example)</option>
        <option value="4">4D (medium example)</option>
        <option value="8">8D (larger example)</option>
      </select>
      <p id="q27-input-dim-help" class="small-caption panel-muted">Input vector dimension (n).</p>
    </div>

    <div class="panel panel-neutral p-4 space-y-2">
      <label for="q27-output-dim" class="block text-sm font-medium text-heading">📈 Output dimension</label>
      <select id="q27-output-dim" aria-describedby="q27-output-dim-help" class="field-select w-full">
        <option value="2">2D (compressed)</option>
        <option value="3" selected>3D (same as input)</option>
        <option value="4">4D (expanded)</option>
        <option value="6">6D (projection)</option>
      </select>
      <p id="q27-output-dim-help" class="small-caption panel-muted">Output vector dimension (m).</p>
    </div>
  </div>

  <div class="flex flex-wrap items-center gap-2">
    <span class="text-sm font-medium text-heading">💡 Quick examples:</span>
    <button id="q27-example-btn" class="btn-soft text-xs">Attention mechanism example</button>
  </div>

  <div class="panel panel-neutral p-4 space-y-4">
    <div class="flex flex-wrap items-center justify-between gap-2">
      <h4 class="font-medium text-heading">🎨 Jacobian analysis results</h4>
      <span id="q27-mode-indicator" class="chip chip-info text-xs">Matrix structure</span>
    </div>
    <div id="q27-output" class="q27-output space-y-3" aria-live="polite" aria-atomic="true" role="status"></div>
    <div id="q27-legend" class="small-caption panel-muted q27-legend" aria-live="polite"></div>
  </div>

  <div class="panel panel-neutral-soft p-4 space-y-3" id="q27-apply-panel">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h5 class="text-sm font-semibold text-heading">Apply the Jacobian</h5>
        <p class="small-caption panel-muted">Set an input vector <em>x</em> and watch <em>J · x</em> play out row by row.</p>
      </div>
      <div class="flex flex-wrap gap-2">
        <button id="q27-apply-play" class="btn-soft text-xs">Animate J · x</button>
        <button id="q27-apply-random" class="btn-soft text-xs">Shuffle inputs</button>
      </div>
    </div>
    <div class="grid gap-3 md:grid-cols-[minmax(0,1fr)_minmax(0,1.75fr)]">
      <div class="space-y-2">
        <div id="q27-vector-controls" class="flex flex-wrap gap-3"></div>
        <p class="small-caption panel-muted">Edit the input components (x₁, x₂, …) to choose the vector the Jacobian acts on.</p>
        <div id="q27-apply-preview" class="text-xs panel-muted"></div>
      </div>
      <div id="q27-apply-steps" class="space-y-2 text-sm"></div>
    </div>
  </div>

  <div class="panel panel-warning p-4 space-y-2">
    <h4 class="font-medium text-heading">📊 Function analysis</h4>
    <div id="q27-explanation" class="text-sm" aria-live="polite"></div>
  </div>
</div>
