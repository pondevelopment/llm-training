<div class="space-y-6" id="q37-interactive-root">
  <div class="panel panel-info panel-emphasis p-4 space-y-4">
    <div class="flex flex-wrap items-center justify-between gap-2">
      <h4 class="text-sm font-semibold text-heading">Expert router controls</h4>
      <span class="chip chip-info text-xs">Active experts are fractions of E</span>
    </div>
    <div class="grid gap-4 text-xs md:grid-cols-5">
      <label class="panel panel-neutral-soft p-3 space-y-2" for="q37-E">
        <span class="text-xs font-semibold text-muted">Experts (E)</span>
        <input id="q37-E" type="range" min="4" max="64" step="1" value="16" aria-label="Number of experts slider" />
        <span class="chip chip-neutral text-xs"><span id="q37-E-val" class="font-mono">16</span></span>
      </label>
      <label class="panel panel-neutral-soft p-3 space-y-2" for="q37-k">
        <span class="text-xs font-semibold text-muted">Top-k</span>
        <input id="q37-k" type="range" min="1" max="8" step="1" value="2" aria-label="Top k experts slider" />
        <span class="chip chip-neutral text-xs"><span id="q37-k-val" class="font-mono">2</span></span>
      </label>
      <label class="panel panel-neutral-soft p-3 space-y-2" for="q37-T">
        <span class="text-xs font-semibold text-muted">Batch tokens (T)</span>
        <input id="q37-T" type="range" min="32" max="2048" step="32" value="256" aria-label="Batch tokens slider" />
        <span class="chip chip-neutral text-xs"><span id="q37-T-val" class="font-mono">256</span></span>
      </label>
      <label class="panel panel-neutral-soft p-3 space-y-2" for="q37-entropy">
        <span class="text-xs font-semibold text-muted">Routing entropy</span>
        <input id="q37-entropy" type="range" min="0" max="1" step="0.05" value="0.4" aria-label="Routing entropy slider" />
        <span class="chip chip-neutral text-xs"><span id="q37-entropy-val" class="font-mono">0.40</span></span>
      </label>
      <label class="panel panel-neutral-soft p-3 space-y-2" for="q37-P">
        <span class="text-xs font-semibold text-muted">Model params (B)</span>
        <input id="q37-P" type="range" min="5" max="200" step="5" value="70" aria-label="Total model parameters in billions slider" />
        <span class="chip chip-neutral text-xs"><span id="q37-P-val" class="font-mono">70</span></span>
      </label>
    </div>
    <p class="text-xs text-muted">Higher routing entropy â‰ˆ more uniform assignments; low entropy â‰ˆ peaky gate â†’ imbalance risk. Active parameter fraction is <span class="font-mono">k/E</span>.</p>
  </div>

  <div class="grid gap-4 md:grid-cols-3">
    <div class="panel panel-neutral p-4 space-y-3">
      <h5 class="text-sm font-semibold text-heading">ðŸ“Œ Metrics</h5>
      <div id="q37-metrics" class="space-y-2 text-xs" role="list" aria-label="MoE derived metrics"></div>
    </div>
    <div class="panel panel-neutral p-4 space-y-3">
      <h5 class="text-sm font-semibold text-heading">ðŸ“ˆ Bars</h5>
      <div id="q37-bars" class="space-y-3 text-xs" role="list" aria-label="Visualization bars for MoE metrics"></div>
    </div>
    <div class="panel panel-neutral p-4 space-y-3">
      <h5 class="text-sm font-semibold text-heading">ðŸ§  Explanation</h5>
      <div id="q37-explain" class="space-y-2 text-sm" aria-live="polite">
        <p>Only the top-k experts are active per token. Compute scales with <span class="font-mono">k</span>, while parameters scale with <span class="font-mono">E</span>.</p>
        <p>Low routing entropy (peaky gate) increases imbalance and can overflow per-expert capacity, reducing realized speedup.</p>
        <div class="math-display">\[
          \text{active fraction} = \frac{k}{E} \
          \text{speedup} \propto \frac{1}{\text{active fraction}}
        \]</div>
      </div>
    </div>
  </div>

  <div class="panel panel-success p-4 space-y-2">
    <h5 class="text-sm font-semibold text-heading">ðŸ’¡ Insight</h5>
    <div id="q37-insight" class="text-sm" aria-live="polite"></div>
  </div>
</div>
