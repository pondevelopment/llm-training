<div class="space-y-6" id="q47-interactive">
  <!-- Controls & Presets -->
  <div class="question-card space-y-4" data-accent="foundations">
    <div class="flex flex-wrap items-center gap-2 text-xs" role="group" aria-label="Presets">
      <span class="font-semibold text-heading">Presets:</span>
      <button type="button" data-q47-preset="ngram-small" class="chip chip-neutral q47-preset-btn">2-gram tiny</button>
      <button type="button" data-q47-preset="ngram-high" class="chip chip-neutral q47-preset-btn">5-gram high</button>
      <button type="button" data-q47-preset="hmm" class="chip chip-neutral q47-preset-btn">HMM tag</button>
      <button type="button" data-q47-preset="tx-short" class="chip chip-neutral q47-preset-btn">Transformer short</button>
      <button type="button" data-q47-preset="tx-long" class="chip chip-neutral q47-preset-btn">Transformer long</button>
      <button type="button" id="q47-tour-btn" class="chip chip-info">Start tour</button>
    </div>
    <div class="grid md:grid-cols-3 gap-3 text-xs">
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-model">Model</label>
        <select id="q47-model" aria-label="Model type" class="field-select field-select--compact w-full">
          <option value="ngram" selected>N-gram</option>
          <option value="hmm">HMM</option>
          <option value="transformer">Transformer</option>
        </select>
      </div>
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-n">Context size / N</label>
        <input id="q47-n" aria-label="Context size slider" type="range" min="1" max="10" value="3" class="w-full q47-range">
        <div class="text-xs panel-muted">N-gram order or transformer visible tokens</div>
      </div>
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-L">Sequence length</label>
        <select id="q47-L" aria-label="Sequence length" class="field-select field-select--compact w-full">
          <option>8</option>
          <option selected>16</option>
          <option>32</option>
          <option>64</option>
        </select>
        <div class="text-xs panel-muted">Tokens in sequence</div>
      </div>
    </div>
    <div class="grid md:grid-cols-3 gap-3 text-xs">
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-smoothing">Smoothing (n-gram)</label>
        <select id="q47-smoothing" aria-label="N-gram smoothing method" class="field-select field-select--compact w-full">
          <option value="none" selected>None</option>
          <option value="addk">Add-k</option>
          <option value="kneser">Kneser-Ney</option>
        </select>
        <div class="text-xs panel-muted">Adjusts sparsity handling</div>
      </div>
      <div class="col-span-2 text-xs panel-muted flex items-center">Smoothing only affects n-gram perplexity (illustrative heuristic).</div>
    </div>
    <div class="grid md:grid-cols-3 gap-3 text-xs">
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-mem">Memory cap <span id="q47-mem-label" class="font-normal text-muted-soft">(transformer only)</span></label>
        <input id="q47-mem" type="range" min="4" max="64" value="64" aria-label="Memory context cap" class="w-full q47-range">
        <div class="text-xs panel-muted">Limits usable tokens. <span id="q47-mem-readout" class="font-medium text-accent"></span></div>
      </div>
      <div class="space-y-1">
        <label class="block text-xs font-semibold text-heading" for="q47-factor">Subword factor</label>
        <select id="q47-factor" aria-label="Subword inflation" class="field-select field-select--compact w-full">
          <option value="1" selected>1.0&times;</option>
          <option value="1.2">1.2&times;</option>
          <option value="1.5">1.5&times;</option>
          <option value="2">2.0&times;</option>
        </select>
        <div class="text-xs panel-muted">Approximate tokens per word</div>
      </div>
      <div class="text-xs panel-muted flex items-center">Shows scaling pressure (cost ~ L^2).</div>
    </div>
  </div>

  <!-- Impact & Guidance -->
  <div class="question-card space-y-4">
    <div class="grid md:grid-cols-3 gap-4 items-start">
      <div class="space-y-2">
        <div class="text-sm font-medium text-heading">Effective context</div>
        <div id="q47-impact" class="space-y-2" aria-live="polite">
          <span id="q47-impact-badge" class="q47-impact-badge" data-level="neutral"></span>
          <div class="q47-impact-meter" data-level="neutral" role="presentation">
            <div id="q47-meter" class="q47-impact-meter-fill" data-level="neutral" style="width:0%"></div>
          </div>
          <div id="q47-coverage" class="text-xs panel-muted"></div>
        </div>
        <div class="text-xs panel-muted-soft">Visibility ratio relative to full sequence length.</div>
      </div>
      <div>
        <div class="text-sm font-medium text-success mb-1">Good for</div>
        <ul id="q47-pros" class="list-disc pl-5 text-xs space-y-1" aria-live="polite"></ul>
      </div>
      <div>
        <div class="text-sm font-medium text-danger mb-1">Watch out for</div>
        <ul id="q47-cons" class="list-disc pl-5 text-xs space-y-1" aria-live="polite"></ul>
      </div>
    </div>
  </div>

  <!-- Canvas -->
  <div class="question-card space-y-4">
    <div id="q47-canvas" class="space-y-3"></div>
  </div>

  <!-- Explanation & Guide -->
  <div id="q47-expl" class="panel panel-warning p-4 text-sm" aria-live="polite"></div>
  <div id="q47-guide" class="panel panel-info p-3 text-xs" aria-live="polite"></div>
  <div id="q47-change" class="text-xs panel-muted"></div>
  <div id="q47-prob" class="panel panel-neutral-soft p-3 text-xs" aria-live="polite"></div>

  <!-- Compare Panel -->
  <div class="question-card space-y-3 text-xs" id="q47-compare" aria-live="polite">
    <div class="flex flex-wrap items-center gap-2">
      <span class="font-semibold text-heading">A/B compare</span>
      <button type="button" id="q47-capA" class="chip chip-neutral">Capture A</button>
      <button type="button" id="q47-capB" class="chip chip-neutral">Capture B</button>
      <button type="button" id="q47-clearCmp" class="chip chip-warning">Clear</button>
    </div>
    <div class="grid md:grid-cols-3 gap-3" id="q47-compare-slots"></div>
    <div id="q47-compare-delta" class="text-xs panel-muted"></div>
  </div>

  <!-- Model Math Pane -->
  <details id="q47-math" class="panel panel-neutral-soft p-3 text-xs">
    <summary class="cursor-pointer font-semibold text-heading">Model math reference</summary>
    <div class="mt-2 space-y-2">
      <div><span class="font-medium text-accent">Chain rule:</span> $$P(w_{1:T}) = \prod_{t=1}^{T} P(w_t \mid w_{1:t-1})$$</div>
      <div><span class="font-medium text-accent">HMM joint:</span> $$P(w_{1:T}, s_{1:T}) = \prod_{t=1}^{T} P(s_t \mid s_{t-1}) P(w_t \mid s_t)$$</div>
      <div><span class="font-medium text-accent">Attention weight:</span> $$\alpha_{t,j} = rac{e^{(q_t \cdot k_j)/\sqrt{d_k}}}{\sum_{j=1}^{T} e^{(q_t \cdot k_j)/\sqrt{d_k}}}$$</div>
    </div>
  </details>

  <!-- Session Trail -->
  <div id="q47-trail-box" class="question-card space-y-2 text-xs">
    <div class="flex items-center justify-between">
      <span class="font-semibold text-heading">Session trail</span>
      <button type="button" id="q47-clearTrail" class="chip chip-neutral">Clear</button>
    </div>
    <ol id="q47-trail" class="list-decimal ml-5 space-y-1 q47-trail" aria-live="polite"></ol>
  </div>
</div>
