<div class="space-y-4 q48">
  <style>

    .q48 {
        --q48-transition: 0.25s ease;
    }
    .q48 .q48-chip {
        display:inline-flex;
        align-items:center;
        font-size:0.75rem;
        line-height:1;
        padding:0.25rem 0.45rem;
        border-radius:9999px;
        margin:2px 6px 2px 0;
        font-weight:600;
        border:1px solid var(--q48-chip-border, transparent);
        background: var(--q48-chip-bg, color-mix(in srgb, var(--color-card) 88%, transparent 12%));
        color: var(--q48-chip-text, var(--color-body));
        transition: background-color var(--q48-transition), color var(--q48-transition), border-color var(--q48-transition);
    }
    .q48 .q48-chip.lr-high {
        --q48-chip-bg: color-mix(in srgb, var(--tone-rose-strong) 22%, var(--color-card) 78%);
        --q48-chip-border: color-mix(in srgb, var(--tone-rose-border) 60%, transparent 40%);
        --q48-chip-text: var(--tone-rose-text);
    }
    .q48 .q48-chip.lr-low {
        --q48-chip-bg: color-mix(in srgb, var(--tone-amber-strong) 20%, var(--color-card) 80%);
        --q48-chip-border: color-mix(in srgb, var(--tone-amber-border) 60%, transparent 40%);
        --q48-chip-text: var(--tone-amber-text);
    }
    .q48 .q48-chip.lr-balanced {
        --q48-chip-bg: color-mix(in srgb, var(--tone-emerald-strong) 20%, var(--color-card) 80%);
        --q48-chip-border: color-mix(in srgb, var(--tone-emerald-border) 58%, transparent 42%);
        --q48-chip-text: var(--tone-emerald-text);
    }
    .q48 .q48-chip.batch-large {
        --q48-chip-bg: color-mix(in srgb, var(--tone-sky-strong) 20%, var(--color-card) 80%);
        --q48-chip-border: color-mix(in srgb, var(--tone-sky-border) 58%, transparent 42%);
        --q48-chip-text: var(--tone-sky-text);
    }
    .q48 .q48-chip.batch-small {
        --q48-chip-bg: color-mix(in srgb, var(--tone-purple-strong) 20%, var(--color-card) 80%);
        --q48-chip-border: color-mix(in srgb, var(--tone-purple-border) 60%, transparent 40%);
        --q48-chip-text: var(--tone-purple-text);
    }
    .q48 .q48-chip.reg-strong {
        --q48-chip-bg: color-mix(in srgb, var(--panel-neutral-bg) 70%, var(--color-card) 30%);
        --q48-chip-border: color-mix(in srgb, var(--panel-neutral-border) 65%, transparent 35%);
        --q48-chip-text: var(--panel-neutral-heading);
    }
    .q48 .q48-chip.reg-low {
        --q48-chip-bg: color-mix(in srgb, var(--tone-amber-strong) 18%, var(--color-card) 82%);
        --q48-chip-border: color-mix(in srgb, var(--tone-amber-border) 60%, transparent 40%);
        --q48-chip-text: var(--tone-amber-text);
    }
    .q48 .q48-chip.risk-overfit {
        --q48-chip-bg: color-mix(in srgb, var(--tone-rose-strong) 28%, var(--color-card) 72%);
        --q48-chip-border: color-mix(in srgb, var(--tone-rose-border) 70%, transparent 30%);
        --q48-chip-text: var(--tone-rose-text);
    }
    .q48 .q48-chip.risk-underfit {
        --q48-chip-bg: color-mix(in srgb, var(--tone-purple-strong) 28%, var(--color-card) 72%);
        --q48-chip-border: color-mix(in srgb, var(--tone-purple-border) 70%, transparent 30%);
        --q48-chip-text: var(--tone-purple-text);
    }
    .q48 .q48-tip {
        cursor:help;
        font-size:0.75rem;
        color: var(--tone-indigo-strong);
        margin-left:4px;
    }
    .q48 .select-input {
        width: 100%;
        padding: 0.45rem 0.65rem;
        background-color: var(--color-card);
        color: var(--color-body);
        border: 1px solid var(--color-border-subtle);
        border-radius: 0.65rem;
        transition: border-color var(--q48-transition), box-shadow var(--q48-transition);
    }
    .q48 .select-input:focus {
        outline: none;
        border-color: var(--accent-strong);
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-strong) 25%, transparent);
    }
    .q48 .select-input option {
        color: var(--color-body);
        background-color: var(--color-card);
    }
    .q48 .q48-progress-track {
        background: color-mix(in srgb, var(--color-card) 55%, var(--color-border) 45%);
    }
    .q48 .q48-preset {
        display:inline-flex;
        align-items:center;
        justify-content:center;
        padding:0.28rem 0.7rem;
        border-radius:0.65rem;
        font-size:0.75rem;
        font-weight:600;
        border:1px solid color-mix(in srgb, var(--color-border-subtle) 75%, transparent 25%);
        background: color-mix(in srgb, var(--color-card) 88%, transparent 12%);
        color: var(--color-body);
        cursor:pointer;
        transition: background-color var(--q48-transition), border-color var(--q48-transition), color var(--q48-transition); 
    }
    .q48 .q48-preset:hover {
        background: color-mix(in srgb, var(--color-card) 76%, transparent 24%);
    }
    .q48 .q48-preset[data-tone="info"] {
        background: var(--tone-indigo-soft);
        border-color: var(--tone-indigo-border);
        color: var(--tone-indigo-text);
    }
    .q48 .q48-preset[data-tone="warning"] {
        background: var(--tone-amber-soft);
        border-color: var(--tone-amber-border);
        color: var(--tone-amber-text);
    }
    .q48 .q48-preset[data-tone="risk"] {
        background: var(--tone-rose-soft);
        border-color: var(--tone-rose-border);
        color: var(--tone-rose-text);
    }
    .q48 .q48-preset[data-tone="accent"] {
        background: var(--tone-purple-soft);
        border-color: var(--tone-purple-border);
        color: var(--tone-purple-text);
    }
    .q48 .q48-preset[data-tone="success"] {
        background: var(--tone-emerald-soft);
        border-color: var(--tone-emerald-border);
        color: var(--tone-emerald-text);
    }
    .q48 .q48-btn {
        display:inline-flex;
        align-items:center;
        justify-content:center;
        font-size:0.75rem;
        font-weight:600;
        padding:0.35rem 0.85rem;
        border-radius:0.65rem;
        border:1px solid transparent;
        cursor:pointer;
        transition: background-color var(--q48-transition), border-color var(--q48-transition), color var(--q48-transition), box-shadow var(--q48-transition);
    }
    .q48 .q48-btn[data-variant="primary"] {
        background: var(--tone-indigo-strong);
        border-color: color-mix(in srgb, var(--tone-indigo-strong) 45%, transparent 55%);
        color: #fff;
    }
    .q48 .q48-btn[data-variant="primary"]:hover {
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--tone-indigo-strong) 25%, transparent);
    }
    .q48 .q48-btn[data-variant="secondary"] {
        background: color-mix(in srgb, var(--color-card) 85%, transparent 15%);
        border-color: color-mix(in srgb, var(--color-border-subtle) 80%, transparent 20%);
        color: var(--color-body);
    }
    .q48 .q48-btn[data-variant="secondary"]:hover {
        background: color-mix(in srgb, var(--color-card) 70%, transparent 30%);
    }
    .q48 .q48-btn[data-variant="neutral"] {
        background: color-mix(in srgb, var(--color-card) 90%, transparent 10%);
        border-color: color-mix(in srgb, var(--color-border-subtle) 65%, transparent 35%);
        color: var(--color-body);
    }
    .q48 .q48-btn[data-variant="neutral"]:hover {
        background: color-mix(in srgb, var(--color-card) 78%, transparent 22%);
    }
    .q48 .q48-btn[data-variant="warning"] {
        background: var(--tone-amber-strong);
        border-color: color-mix(in srgb, var(--tone-amber-strong) 45%, transparent 55%);
        color: #fff;
    }
    .q48 .q48-btn[data-variant="warning"]:hover {
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--tone-amber-strong) 25%, transparent);
    }
    .q48 .q48-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        box-shadow: none;
    }
    .q48-flash-up { animation:q48FlashUp 0.6s ease-out; }
    .q48-flash-down { animation:q48FlashDown 0.6s ease-out; }
    @keyframes q48FlashUp {
        0% { box-shadow:0 0 0 0 color-mix(in srgb, var(--tone-emerald-strong) 70%, transparent 30%); }
        100% { box-shadow:0 0 0 12px transparent; }
    }
    @keyframes q48FlashDown {
        0% { box-shadow:0 0 0 0 color-mix(in srgb, var(--tone-rose-strong) 70%, transparent 30%); }
        100% { box-shadow:0 0 0 12px transparent; }
    }
    .q48-meter-track {
        background: color-mix(in srgb, var(--color-card) 60%, var(--color-border) 40%);
    }
    .q48-meter {
        height:100%;
        width:0%;
        border-radius:inherit;
        background: color-mix(in srgb, var(--tone-indigo-strong) 60%, transparent 40%);
        transition: width 0.3s ease, background-color var(--q48-transition);
    }
    .q48-meter.is-excellent { background: color-mix(in srgb, var(--tone-emerald-strong) 65%, transparent 35%); }
    .q48-meter.is-good { background: color-mix(in srgb, var(--tone-sky-strong) 65%, transparent 35%); }
    .q48-meter.is-limited { background: color-mix(in srgb, var(--tone-amber-strong) 65%, transparent 35%); }
    .q48-meter.is-poor { background: color-mix(in srgb, var(--tone-rose-strong) 65%, transparent 35%); }
    .q48-impact-badge {
        display:inline-flex;
        align-items:center;
        padding:0.15rem 0.55rem;
        border-radius:0.5rem;
        font-weight:600;
        border:1px solid color-mix(in srgb, var(--color-border) 45%, transparent 55%);
        background: color-mix(in srgb, var(--color-card) 88%, transparent 12%);
        color: var(--color-body);
        transition: background-color var(--q48-transition), border-color var(--q48-transition), color var(--q48-transition);
    }
    .q48-impact-badge.is-excellent {
        background: color-mix(in srgb, var(--tone-emerald-strong) 22%, var(--color-card) 78%);
        border-color: color-mix(in srgb, var(--tone-emerald-border) 65%, transparent 35%);
        color: var(--tone-emerald-text);
    }
    .q48-impact-badge.is-good {
        background: color-mix(in srgb, var(--tone-sky-strong) 22%, var(--color-card) 78%);
        border-color: color-mix(in srgb, var(--tone-sky-border) 65%, transparent 35%);
        color: var(--tone-sky-text);
    }
    .q48-impact-badge.is-limited {
        background: color-mix(in srgb, var(--tone-amber-strong) 22%, var(--color-card) 78%);
        border-color: color-mix(in srgb, var(--tone-amber-border) 60%, transparent 40%);
        color: var(--tone-amber-text);
    }
    .q48-impact-badge.is-poor {
        background: color-mix(in srgb, var(--tone-rose-strong) 22%, var(--color-card) 78%);
        border-color: color-mix(in srgb, var(--tone-rose-border) 65%, transparent 35%);
        color: var(--tone-rose-text);
    }
    .q48-noise-bar {
        height:100%;
        width:0%;
        border-radius:inherit;
        background: color-mix(in srgb, var(--tone-purple-strong) 65%, transparent 35%);
        transition: width 0.3s ease;
    }
    .q48-swatch {
        width:10px;
        height:10px;
        border-radius:2px;
        display:inline-block;
        border:1px solid color-mix(in srgb, var(--color-border) 55%, transparent 45%);
    }
    .q48-swatch--train { background: var(--tone-sky-strong); }
    .q48-swatch--val { background: var(--color-path-scaling-strong); }
    .q48-break-fill {
        height:100%;
        border-radius:inherit;
        opacity:0.9;
        transition: width 0.3s ease;
    }
    .q48-break-fill--wd { background: color-mix(in srgb, var(--tone-sky-strong) 60%, transparent 40%); }
    .q48-break-fill--drop { background: color-mix(in srgb, var(--tone-purple-strong) 60%, transparent 40%); }
    .q48-break-fill--noise { background: color-mix(in srgb, var(--tone-amber-strong) 60%, transparent 40%); }
    .q48-sens-track {
        position:relative;
        background: color-mix(in srgb, var(--color-card) 78%, transparent 22%);
        border:1px solid color-mix(in srgb, var(--color-border) 60%, transparent 40%);
        border-radius:9999px;
    }
    .q48-sens-fill {
        position:absolute;
        top:0;
        bottom:0;
        opacity:0.55;
        transition: width var(--q48-transition);
    }
    .q48-sens-fill--positive { background: color-mix(in srgb, var(--tone-emerald-strong) 65%, transparent 35%); }
    .q48-sens-fill--negative { background: color-mix(in srgb, var(--tone-rose-strong) 65%, transparent 35%); }
    .q48-sens-axis {
        position:absolute;
        left:50%;
        top:0;
        bottom:0;
        width:1px;
        background: color-mix(in srgb, var(--color-secondary) 85%, transparent 15%);
    }
    }</style>
            <!-- Controls -->
            <div class="panel panel-info panel-emphasis p-4 space-y-4">
                <div class="grid md:grid-cols-4 gap-3" aria-label="Hyperparameter controls">
                    <div>
                        <label for="q48-lr" class="block text-sm font-medium text-heading mb-1">Learning rate (η)
                            <span class="q48-tip" title="Too high -> divergence; too low -> slow convergence; sweet spot often ~1e-4-5e-3 for many transformer fine-tunes.">ℹ️</span>
                        </label>
                        <input id="q48-lr" type="range" min="-4" max="-1" step="0.1" value="-2.5" class="w-full" aria-describedby="q48-lr-help q48-lr-val" aria-label="Learning rate log10 slider">
                        <div id="q48-lr-help" class="text-xs text-muted">Log10 scale: η = 10^x | current: <span id="q48-lr-val" class="font-semibold"></span></div>
                    </div>
                    <div>
                        <label for="q48-bs" class="block text-sm font-medium text-heading mb-1">Batch size
                            <span class="q48-tip" title="Larger batch -> smoother gradients but less noise regularization; very large batches may need LR warmup.">ℹ️</span>
                        </label>
                        <select id="q48-bs" class="select-input w-full" aria-label="Batch size">
                            <option>8</option>
                            <option>16</option>
                            <option selected>32</option>
                            <option>64</option>
                            <option>128</option>
                        </select>
                        <div class="text-xs text-muted">Samples / optimizer step</div>
                    </div>
                    <div>
                        <label for="q48-wd" class="block text-sm font-medium text-heading mb-1">Weight decay
                            <span class="q48-tip" title="L2 penalty: prevents weights growing too large; too high shrinks signal -> underfitting.">ℹ️</span>
                        </label>
                        <input id="q48-wd" type="range" min="0" max="0.1" step="0.005" value="0.01" class="w-full" aria-label="Weight decay slider">
                        <div class="text-xs text-muted">L2 strength: <span id="q48-wd-val" class="font-semibold"></span></div>
                    </div>
                    <div>
                        <label for="q48-do" class="block text-sm font-medium text-heading mb-1">Dropout
                            <span class="q48-tip" title="Randomly drops activations: improves generalization; too high slows learning & reduces capacity.">ℹ️</span>
                        </label>
                        <input id="q48-do" type="range" min="0" max="0.7" step="0.05" value="0.1" class="w-full" aria-label="Dropout probability slider">
                        <div class="text-xs text-muted">p(drop): <span id="q48-do-val" class="font-semibold"></span></div>
                    </div>
                </div>
                <div class="mt-4 flex flex-wrap items-center" aria-label="Detected regimes"><div id="q48-regimes" class="flex flex-wrap"></div>
                    <button id="q48-snapshot-btn" class="ml-auto q48-btn" data-variant="primary" type="button">Copy snapshot</button>
                    <span id="q48-snapshot-status" class="text-xs text-muted ml-2"></span>
                </div>
            </div>

            <!-- Impact & Guidance -->
            <div class="panel panel-neutral p-4">
                <div class="grid md:grid-cols-3 gap-4 items-start">
                    <div>
                        <div class="text-sm font-medium text-heading mb-1">Stability/Speed estimate</div>
                        <div id="q48-impact" class="text-xs">
                            <span id="q48-impact-badge" class="q48-impact-badge"></span>
                            <div class="h-2 mt-1 rounded q48-meter-track overflow-hidden">
                                <div id="q48-meter" class="q48-meter"></div>
                            </div>
                        </div>
                        <div class="text-xs text-muted mt-1">Heuristic based on η, batch size, and regularization.</div>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-success mb-1">Good points</div>
                        <ul id="q48-pros" class="list-disc pl-5 text-xs text-heading space-y-1"></ul>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-danger mb-1">Potential issues</div>
                        <ul id="q48-cons" class="list-disc pl-5 text-xs text-heading space-y-1"></ul>
                    </div>
                </div>
            </div>

            <!-- Training Dynamics Simulation -->
            <div class="panel panel-neutral p-4 space-y-4" aria-label="Synthetic training dynamics">
                <div class="flex items-center justify-between">
                    <h4 class="text-sm font-semibold text-heading">Synthetic training curves (heuristic)</h4>
                    <div class="text-xs text-muted">Not real data - shaped by current hyperparameters</div>
                </div>
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <canvas id="q48-curve" width="460" height="140" class="w-full border border-divider bg-card rounded" aria-label="Training and validation loss curves"></canvas>
                        <div class="flex items-center gap-3 mt-1 text-xs">
                            <span class="inline-flex items-center gap-1"><span class="q48-swatch q48-swatch--train"></span> Train loss</span>
                            <span class="inline-flex items-center gap-1"><span class="q48-swatch q48-swatch--val"></span> Val loss</span>
                            <span id="q48-curve-label" class="ml-auto text-muted"></span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <div class="text-xs font-medium text-muted mb-1">Gradient noise</div>
                            <div class="h-2 rounded q48-progress-track overflow-hidden"><div id="q48-noise-bar" class="q48-noise-bar"></div></div>
                            <div id="q48-noise-text" class="text-xs text-muted mt-1"></div>
                        </div>
                        <div>
                            <div class="text-xs font-medium text-muted mb-1">Effective step size</div>
                            <div id="q48-effstep" class="text-xs font-mono bg-subtle border border-divider rounded px-2 py-1"></div>
                        </div>
                        <div>
                            <div class="text-xs font-medium text-muted mb-1">Parameter norm trend</div>
                            <canvas id="q48-norm" width="150" height="70" class="w-full border border-divider bg-card rounded" aria-label="Parameter norm trend"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scenario Presets & A/B Compare -->
            <div class="panel panel-neutral p-4 space-y-3" aria-label="Presets and comparison tools">
                <div class="flex flex-wrap gap-2 items-center">
                    <span class="text-xs font-semibold text-muted mr-1">Presets:</span>
                    <button type="button" class="q48-preset" data-tone="info" data-preset="balanced">Balanced</button>
                    <button type="button" class="q48-preset" data-tone="warning" data-preset="underfit">Underfit</button>
                    <button type="button" class="q48-preset" data-tone="risk" data-preset="overfit">Overfit risk</button>
                    <button type="button" class="q48-preset" data-tone="accent" data-preset="unstable">Unstable LR</button>
                    <button type="button" class="q48-preset" data-tone="success" data-preset="slow">Smooth but slow</button>
                </div>
                <div class="flex flex-wrap gap-2 items-center pt-2 border-t">
                    <span class="text-xs font-semibold text-muted">A/B Compare:</span>
                    <button id="q48-capture-a" type="button" class="q48-btn" data-variant="primary">Capture A</button>
                    <button id="q48-capture-b" type="button" class="q48-btn" data-variant="secondary" disabled>Capture B</button>
                    <button id="q48-clear-ab" type="button" class="q48-btn" data-variant="neutral" disabled>Clear</button>
                    <span id="q48-ab-status" class="text-xs text-muted"></span>
                </div>
                <div id="q48-ab-panel" class="hidden text-xs panel panel-neutral-soft p-3 space-y-2">
                    <div class="font-semibold text-heading">A vs B Differences</div>
                    <div id="q48-ab-diff" class="font-mono whitespace-pre-wrap"></div>
                </div>
            </div>

            <!-- Sensitivity & Interactions -->
            <div class="panel panel-info p-4 space-y-4" aria-label="Sensitivity analysis">
                <div class="flex items-center justify-between">
                    <h4 class="text-sm font-semibold text-info">Local sensitivity (score delta if nudged)</h4>
                    <span class="text-xs text-info">+/- small perturbation around current point</span>
                </div>
                <div id="q48-sensitivity" class="space-y-2"></div>
                <div>
                    <h5 class="text-xs font-semibold text-info mb-1">Interaction insight</h5>
                    <div id="q48-interactions" class="text-xs panel panel-neutral-soft p-2 leading-snug"></div>
                </div>
            </div>

            <!-- Advanced Exploration (Phase 4) -->
            <div class="panel panel-neutral p-4 space-y-4" aria-label="Advanced hyperparameter exploration">
                <div class="flex items-center justify-between flex-wrap gap-2">
                    <h4 class="text-sm font-semibold text-heading">Advanced tools</h4>
                    <div class="flex gap-2 flex-wrap">
                        <button id="q48-run-lr-finder" type="button" class="q48-btn" data-variant="warning">Run LR finder</button>
                        <button id="q48-export-trail" type="button" class="q48-btn" data-variant="secondary">Export trail</button>
                        <span id="q48-adv-status" class="text-xs text-muted"></span>
                    </div>
                </div>
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="col-span-2 space-y-3">
                        <div>
                            <div class="flex items-center justify-between mb-1"><span class="text-xs font-medium text-heading">LR finder (synthetic sweep)</span><span id="q48-lr-window" class="text-xs text-muted"></span></div>
                            <canvas id="q48-lr-finder" width="460" height="120" class="w-full border border-divider bg-card rounded" aria-label="Learning rate finder synthetic curve"></canvas>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1"><span class="text-xs font-medium text-heading">Noise vs signal (gradient direction drift)</span><span id="q48-noise-ratio" class="text-xs text-muted"></span></div>
                            <canvas id="q48-noise-signal" width="460" height="110" class="w-full border border-divider bg-card rounded" aria-label="Noise vs signal scatter"></canvas>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <div class="text-xs font-medium text-heading mb-1">Regularization components</div>
                            <div id="q48-reg-break" class="text-xs panel panel-neutral-soft p-2 space-y-1"></div>
                        </div>
                        <div>
                            <div class="text-xs font-medium text-heading mb-1">Auto-tune suggestion</div>
                            <div id="q48-suggestion" class="text-xs panel panel-info p-2 leading-snug"></div>
                        </div>
                        <div>
                            <div class="text-xs font-medium text-heading mb-1">Session trail (recent)</div>
                            <div id="q48-trail" class="text-xs font-mono panel panel-neutral-soft p-2 h-28 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output -->
            <div id="q48-expl" class="panel panel-warning p-4 text-sm" aria-live="polite"></div>
            <div id="q48-change" class="text-xs text-muted" aria-live="polite"></div>
        </div>











