<div class="space-y-6">
  <div class="panel panel-info p-4 space-y-2">
    <h4 class="font-semibold text-heading">üìö Recommended reading (related)</h4>
    <ul class="list-disc pl-5 text-sm text-body space-y-1">
      <li><a href="#question-53" class="text-link">Question 53: Decoding strategies (how tokens are selected)</a></li>
      <li><a href="#question-54" class="text-link">Question 54: Logits &amp; probability transformations</a></li>
      <li><a href="#question-6" class="text-link">Question 6: Temperature effects</a></li>
      <li><a href="#question-12" class="text-link">Question 12: Top-k vs top-p sampling</a></li>
      <li><a href="#question-5" class="text-link">Question 5: Beam search</a></li>
      <li><a href="#question-3" class="text-link">Question 3: Context window limits</a></li>
      <li><a href="#question-18" class="text-link">Question 18: (Contrast) Training early stopping</a></li>
    </ul>
  </div>

  <div class="panel panel-info panel-emphasis p-4 space-y-4">
    <h4 class="font-semibold text-heading">üõë Why Stopping Matters</h4>
    <p class="text-sm text-body leading-relaxed">A generation session is a <strong>constrained optimisation</strong>: maximise utility (clarity, completeness, safety) while minimising cost (tokens, latency, risk). Choosing <em>when to stop</em> is as important as choosing <em>what to emit next</em>. Done well, stopping feels invisible; done poorly, users see cut sentences, runaway rambles, malformed JSON, or policy leaks.</p>
    <div class="grid md:grid-cols-2 gap-3 text-sm">
      <div class="panel panel-neutral-soft p-3 space-y-1">
        <div class="font-medium text-heading">Cost &amp; Latency</div>
        <ul class="list-disc pl-4 text-muted space-y-0.5">
          <li>Each extra token consumes budget and latency.</li>
          <li>Early stop on a stable answer improves UX.</li>
          <li>Streaming UIs need responsive abort paths.</li>
        </ul>
      </div>
      <div class="panel panel-neutral-soft p-3 space-y-1">
        <div class="font-medium text-heading">Coherence &amp; Quality</div>
        <ul class="list-disc pl-4 text-muted space-y-0.5">
          <li>Good endings align with discourse structure.</li>
          <li>Overrun drifts into repetition or filler.</li>
          <li>Balanced structures (JSON or code) must close.</li>
        </ul>
      </div>
      <div class="panel panel-neutral-soft p-3 space-y-1">
        <div class="font-medium text-heading">Safety &amp; Compliance</div>
        <ul class="list-disc pl-4 text-muted space-y-0.5">
          <li>Terminate as soon as disallowed content patterns emerge.</li>
          <li>Reduce the window for compounding policy violations.</li>
          <li>Log stop reason for audit (e.g. <code>policy_toxicity</code>).</li>
        </ul>
      </div>
      <div class="panel panel-neutral-soft p-3 space-y-1">
        <div class="font-medium text-heading">Structural Integrity</div>
        <ul class="list-disc pl-4 text-muted space-y-0.5">
          <li>APIs consuming JSON or tool calls need valid closure.</li>
          <li>Guard against truncation mid-object.</li>
          <li>Layer structural validation with token limits.</li>
        </ul>
      </div>
    </div>
    <div class="panel panel-neutral-soft p-3 text-xs text-muted">
      <strong>Contrast vs training early stopping:</strong> training early stopping halts updates to prevent overfitting; inference stopping halts token emission to preserve quality, safety, and efficiency. They share the idea of ‚Äúdiminishing returns‚Äù but operate on different signals (validation loss vs incremental generation heuristics).
    </div>
    <p class="small-caption text-muted"><strong>Interplay:</strong> decoding policy proposes a candidate; the stopping layer evaluates global state (tokens used, structures closed, patterns matched). Separation of concerns keeps logic maintainable and auditable.</p>
  </div>

  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div class="panel panel-success panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">1. Token / Budget Based</h5>
      <p class="text-xs text-body leading-snug">Hard limits: EOS token, max tokens, timeout.</p>
    </div>
    <div class="panel panel-accent panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">2. Pattern / String Based</h5>
      <p class="text-xs text-body leading-snug">Substring or delimiter match (normalise + longest-first).</p>
    </div>
    <div class="panel panel-warning panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">3. Structural Completion</h5>
      <p class="text-xs text-body leading-snug">Detect balanced or closed syntactic containers.</p>
    </div>
    <div class="panel panel-warning panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">4. Safety / Quality</h5>
      <p class="text-xs text-body leading-snug">Policy triggers, degeneracy, repetition loops.</p>
    </div>
    <div class="panel panel-info panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">5. Probabilistic / Dynamic</h5>
      <p class="text-xs text-body leading-snug">Entropy or marginal utility thresholds detect saturation.</p>
    </div>
    <div class="panel panel-neutral panel-emphasis p-3 shadow-sm space-y-1">
      <h5 class="font-medium text-heading">6. Human / Operational</h5>
      <p class="text-xs text-body leading-snug">External interrupts: user cancel, channel close, budget guard.</p>
    </div>
  </div>

  <div class="panel panel-success p-4 space-y-1">
    <h4 class="font-semibold text-heading">‚úÖ Design Tips</h4>
    <ul class="list-disc pl-5 text-sm text-body space-y-1">
      <li>Normalise text (Unicode and whitespace) before matching stop sequences.</li>
      <li>Apply <strong>longest stop string first</strong> to avoid premature partial matches.</li>
      <li>Keep structural guards (JSON balance) orthogonal to textual stops.</li>
      <li>Log the <em>first triggered criterion</em> plus diagnostics for observability.</li>
      <li>Distinguish <code>truncated = true</code> (budget hit) vs <code>stopped = eos</code> for downstream logic.</li>
    </ul>
  </div>

  <div class="panel panel-warning panel-emphasis p-4 space-y-1">
    <h4 class="font-semibold text-heading">‚ö†Ô∏è Common Pitfalls</h4>
    <ul class="list-disc pl-5 text-sm text-body space-y-1">
      <li>Partial stop sequence split across streaming chunks.</li>
      <li>Unclosed JSON because only the max token cap fired.</li>
      <li>Double termination: both EOS and stop string (record canonical reason).</li>
      <li>Premature structural stop when braces appear inside code blocks.</li>
      <li>Repetition detector firing on short contexts (need warmup tokens).</li>
    </ul>
  </div>
</div>
